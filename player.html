<script src="https://vjs.zencdn.net/7.21.1/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-contrib-hls@latest/dist/videojs-contrib-hls.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/3.0.9/shaka-player.compiled.js"></script>
<script>
    const params = new URLSearchParams(window.location.search);
    const streamUrl = decodeURIComponent(params.get('url'));
    const channelName = decodeURIComponent(params.get('name'));

    document.getElementById('channel-name').innerText = channelName;

    const log = (message) => {
        const logContainer = document.getElementById('debug-log');
        const logEntry = document.createElement('p');
        logEntry.innerText = message;
        logContainer.appendChild(logEntry);
    };

    const errorMessage = document.getElementById('error-message');

    // Initialize Video.js player
    const player = videojs('video');

    player.ready(() => {
        player.src({
            src: streamUrl,
            type: 'application/x-mpegURL'
        });
        player.play();

        player.on('error', async () => {
            errorMessage.innerText = 'Error: Unable to play the stream with Video.js. Trying Shaka Player...';
            log('Error encountered while trying to play the stream with Video.js.');

            // Attempt to initialize Shaka Player
            const shakaPlayer = new shaka.Player(document.getElementById('video'));

            try {
                await shakaPlayer.load(streamUrl);
                log('Successfully loaded stream with Shaka Player.');
                shakaPlayer.play();
            } catch (error) {
                errorMessage.innerText = 'Error loading stream with Shaka Player: ' + error.message;
                log('Shaka Player error:', error);
            }
        });
    });
        </script>
