<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Player</title>
    <link href="https://unpkg.com/video.js/dist/video-js.css" rel="stylesheet">
</head>
<body>
    <video id="video" class="video-js vjs-default-skin" controls></video>
    
    <!-- Include video.js and hls.js -->
    <script src="https://unpkg.com/video.js/dist/video.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <script>
        const videoElement = document.getElementById('video');
        const urlParams = new URLSearchParams(window.location.search);
        const m3u8Url = urlParams.get('url');

        function tryVideoJs() {
            const player = videojs(videoElement, {
                sources: [{ src: m3u8Url, type: 'application/x-mpegURL' }]
            });

            // Error handler to check if it fails due to CORS
            player.on('error', function() {
                console.warn('CORS blocked the stream or the stream format is unsupported. Trying with hls.js...');
                player.dispose(); // Clean up video.js player instance
                tryHlsJs(); // Fallback to hls.js
            });

            player.ready(function() {
                player.play().catch(error => {
                    console.warn("Video.js failed to play:", error);
                    tryHlsJs();
                });
            });
        }

        function tryHlsJs() {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(m3u8Url);
                hls.attachMedia(videoElement);
                hls.on(Hls.Events.ERROR, function(event, data) {
                    if (data.type === Hls.ErrorTypes.NETWORK_ERROR) {
                        alert("Unable to play the stream due to CORS restrictions.");
                    }
                });
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = m3u8Url;
                videoElement.play().catch(error => {
                    alert("Unable to play the stream: " + error.message);
                });
            } else {
                alert("Your browser does not support HLS playback.");
            }
        }

        // Start by attempting to play with video.js
        tryVideoJs();
    </script>
</body>
</html>
